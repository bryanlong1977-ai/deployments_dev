# GitHub Actions Full Landing Zone Deployment Workflow
# This workflow deploys ALL deployment steps in sequence
# Generated by CloudCraft AI
#
# Deployment Order:
#   1. Network Deployment 1 (connectivity)
#   2. Network Deployment 1 (identity)
#   3. Network Deployment 1 (management)
#   4. Tools Deployment 1 (management)
#   5. Tools Deployment 2 (management)
#   6. Tools Deployment 1 (identity)
#   7. Tools Deployment 1 (connectivity)
#   8. Network Deployment 2 (connectivity)
#   9. Network Deployment 2 (identity)
#   10. Network Deployment 2 (management)
#   11. Network Deployment 1 (dmz)
#   12. Tools Deployment 1 (dmz)
#   13. NSG Deployment 1 (connectivity)
#   14. NSG Deployment 1 (identity)
#   15. NSG Deployment 1 (management)
#   16. Route Table Deployment 1 (connectivity)
#   17. Route Table Deployment 1 (identity)
#   18. Route Table Deployment 1 (management)
#   19. NSG Deployment 1 (dmz)
#   20. Route Table Deployment 1 (dmz)

name: Full Landing Zone Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment'
        required: true
        type: choice
        options:
          - production
          - staging
          - development
        default: 'production'

permissions:
  id-token: write
  contents: read

env:
  TF_VERSION: '1.5.0'

jobs:
  step_1_connectivity_network_deployment_1_plan:
    name: 'Step 1 Plan: Network Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-1-network-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-1/tfplan
          retention-days: 5

  step_1_connectivity_network_deployment_1_apply:
    name: 'Step 1 Apply: Network Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_1_connectivity_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-1-network-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_2_identity_network_deployment_1_plan:
    name: 'Step 2 Plan: Network Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_1_connectivity_network_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-2-network-deployment-1
          path: landingzone/hub-spoke-primary/identity/network-deployment-1/tfplan
          retention-days: 5

  step_2_identity_network_deployment_1_apply:
    name: 'Step 2 Apply: Network Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_2_identity_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-2-network-deployment-1
          path: landingzone/hub-spoke-primary/identity/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_3_management_network_deployment_1_plan:
    name: 'Step 3 Plan: Network Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_2_identity_network_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-3-network-deployment-1
          path: landingzone/hub-spoke-primary/management/network-deployment-1/tfplan
          retention-days: 5

  step_3_management_network_deployment_1_apply:
    name: 'Step 3 Apply: Network Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_3_management_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-3-network-deployment-1
          path: landingzone/hub-spoke-primary/management/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_4_management_tools_deployment_1_plan:
    name: 'Step 4 Plan: Tools Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_3_management_network_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-4-tools-deployment-1
          path: landingzone/hub-spoke-primary/management/tools-deployment-1/tfplan
          retention-days: 5

  step_4_management_tools_deployment_1_apply:
    name: 'Step 4 Apply: Tools Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_4_management_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-4-tools-deployment-1
          path: landingzone/hub-spoke-primary/management/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_5_management_tools_deployment_2_plan:
    name: 'Step 5 Plan: Tools Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: step_4_management_tools_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-5-tools-deployment-2
          path: landingzone/hub-spoke-primary/management/tools-deployment-2/tfplan
          retention-days: 5

  step_5_management_tools_deployment_2_apply:
    name: 'Step 5 Apply: Tools Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: step_5_management_tools_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-5-tools-deployment-2
          path: landingzone/hub-spoke-primary/management/tools-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_6_identity_tools_deployment_1_plan:
    name: 'Step 6 Plan: Tools Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_5_management_tools_deployment_2_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-6-tools-deployment-1
          path: landingzone/hub-spoke-primary/identity/tools-deployment-1/tfplan
          retention-days: 5

  step_6_identity_tools_deployment_1_apply:
    name: 'Step 6 Apply: Tools Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_6_identity_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-6-tools-deployment-1
          path: landingzone/hub-spoke-primary/identity/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_7_connectivity_tools_deployment_1_plan:
    name: 'Step 7 Plan: Tools Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_6_identity_tools_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-7-tools-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/tools-deployment-1/tfplan
          retention-days: 5

  step_7_connectivity_tools_deployment_1_apply:
    name: 'Step 7 Apply: Tools Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_7_connectivity_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-7-tools-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_8_connectivity_network_deployment_2_plan:
    name: 'Step 8 Plan: Network Deployment 2 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_7_connectivity_tools_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-8-network-deployment-2
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-2/tfplan
          retention-days: 5

  step_8_connectivity_network_deployment_2_apply:
    name: 'Step 8 Apply: Network Deployment 2 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_8_connectivity_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-8-network-deployment-2
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_9_identity_network_deployment_2_plan:
    name: 'Step 9 Plan: Network Deployment 2 (identity)'
    runs-on: ubuntu-latest
    needs: step_8_connectivity_network_deployment_2_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-9-network-deployment-2
          path: landingzone/hub-spoke-primary/identity/network-deployment-2/tfplan
          retention-days: 5

  step_9_identity_network_deployment_2_apply:
    name: 'Step 9 Apply: Network Deployment 2 (identity)'
    runs-on: ubuntu-latest
    needs: step_9_identity_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-9-network-deployment-2
          path: landingzone/hub-spoke-primary/identity/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_10_management_network_deployment_2_plan:
    name: 'Step 10 Plan: Network Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: step_9_identity_network_deployment_2_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-10-network-deployment-2
          path: landingzone/hub-spoke-primary/management/network-deployment-2/tfplan
          retention-days: 5

  step_10_management_network_deployment_2_apply:
    name: 'Step 10 Apply: Network Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: step_10_management_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-10-network-deployment-2
          path: landingzone/hub-spoke-primary/management/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_11_dmz_network_deployment_1_plan:
    name: 'Step 11 Plan: Network Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_10_management_network_deployment_2_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-11-network-deployment-1
          path: landingzone/hub-spoke-primary/dmz/network-deployment-1/tfplan
          retention-days: 5

  step_11_dmz_network_deployment_1_apply:
    name: 'Step 11 Apply: Network Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_11_dmz_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-11-network-deployment-1
          path: landingzone/hub-spoke-primary/dmz/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_12_dmz_tools_deployment_1_plan:
    name: 'Step 12 Plan: Tools Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_11_dmz_network_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-12-tools-deployment-1
          path: landingzone/hub-spoke-primary/dmz/tools-deployment-1/tfplan
          retention-days: 5

  step_12_dmz_tools_deployment_1_apply:
    name: 'Step 12 Apply: Tools Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_12_dmz_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-12-tools-deployment-1
          path: landingzone/hub-spoke-primary/dmz/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_13_connectivity_nsg_deployment_1_plan:
    name: 'Step 13 Plan: NSG Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_12_dmz_tools_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-13-nsg-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1/tfplan
          retention-days: 5

  step_13_connectivity_nsg_deployment_1_apply:
    name: 'Step 13 Apply: NSG Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_13_connectivity_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-13-nsg-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_14_identity_nsg_deployment_1_plan:
    name: 'Step 14 Plan: NSG Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_13_connectivity_nsg_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-14-nsg-deployment-1
          path: landingzone/hub-spoke-primary/identity/nsg-deployment-1/tfplan
          retention-days: 5

  step_14_identity_nsg_deployment_1_apply:
    name: 'Step 14 Apply: NSG Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_14_identity_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-14-nsg-deployment-1
          path: landingzone/hub-spoke-primary/identity/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_15_management_nsg_deployment_1_plan:
    name: 'Step 15 Plan: NSG Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_14_identity_nsg_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-15-nsg-deployment-1
          path: landingzone/hub-spoke-primary/management/nsg-deployment-1/tfplan
          retention-days: 5

  step_15_management_nsg_deployment_1_apply:
    name: 'Step 15 Apply: NSG Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_15_management_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-15-nsg-deployment-1
          path: landingzone/hub-spoke-primary/management/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_16_connectivity_route_table_deployment_1_plan:
    name: 'Step 16 Plan: Route Table Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_15_management_nsg_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-16-route-table-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1/tfplan
          retention-days: 5

  step_16_connectivity_route_table_deployment_1_apply:
    name: 'Step 16 Apply: Route Table Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: step_16_connectivity_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-16-route-table-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_17_identity_route_table_deployment_1_plan:
    name: 'Step 17 Plan: Route Table Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_16_connectivity_route_table_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-17-route-table-deployment-1
          path: landingzone/hub-spoke-primary/identity/route-table-deployment-1/tfplan
          retention-days: 5

  step_17_identity_route_table_deployment_1_apply:
    name: 'Step 17 Apply: Route Table Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: step_17_identity_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-17-route-table-deployment-1
          path: landingzone/hub-spoke-primary/identity/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_18_management_route_table_deployment_1_plan:
    name: 'Step 18 Plan: Route Table Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_17_identity_route_table_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-18-route-table-deployment-1
          path: landingzone/hub-spoke-primary/management/route-table-deployment-1/tfplan
          retention-days: 5

  step_18_management_route_table_deployment_1_apply:
    name: 'Step 18 Apply: Route Table Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: step_18_management_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-18-route-table-deployment-1
          path: landingzone/hub-spoke-primary/management/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_19_dmz_nsg_deployment_1_plan:
    name: 'Step 19 Plan: NSG Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_18_management_route_table_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-19-nsg-deployment-1
          path: landingzone/hub-spoke-primary/dmz/nsg-deployment-1/tfplan
          retention-days: 5

  step_19_dmz_nsg_deployment_1_apply:
    name: 'Step 19 Apply: NSG Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_19_dmz_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-19-nsg-deployment-1
          path: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  step_20_dmz_route_table_deployment_1_plan:
    name: 'Step 20 Plan: Route Table Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_19_dmz_nsg_deployment_1_apply
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform plan -input=false -out=tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-step-20-route-table-deployment-1
          path: landingzone/hub-spoke-primary/dmz/route-table-deployment-1/tfplan
          retention-days: 5

  step_20_dmz_route_table_deployment_1_apply:
    name: 'Step 20 Apply: Route Table Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: step_20_dmz_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-step-20-route-table-deployment-1
          path: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Apply
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
