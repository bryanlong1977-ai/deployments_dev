# GitHub Actions Full Landing Zone DESTROY Workflow
# ⚠️ WARNING: This workflow DESTROYS all infrastructure in REVERSE deployment order
# Generated by CloudCraft AI
#
# Original Deployment Order:
#   1. Network Deployment 1 (connectivity)
#   2. Network Deployment 1 (identity)
#   3. Network Deployment 1 (management)
#   4. Tools Deployment 1 (management)
#   5. Tools Deployment 2 (management)
#   6. Tools Deployment 1 (identity)
#   7. Tools Deployment 1 (connectivity)
#   8. Network Deployment 2 (connectivity)
#   9. Network Deployment 2 (identity)
#   10. Network Deployment 2 (management)
#   11. Network Deployment 1 (dmz)
#   12. Tools Deployment 1 (dmz)
#   13. NSG Deployment 1 (connectivity)
#   14. NSG Deployment 1 (identity)
#   15. NSG Deployment 1 (management)
#   16. Route Table Deployment 1 (connectivity)
#   17. Route Table Deployment 1 (identity)
#   18. Route Table Deployment 1 (management)
#   19. NSG Deployment 1 (dmz)
#   20. Route Table Deployment 1 (dmz)
#
# Destroy Order (REVERSED):
#   1. Route Table Deployment 1 (dmz)
#   2. NSG Deployment 1 (dmz)
#   3. Route Table Deployment 1 (management)
#   4. Route Table Deployment 1 (identity)
#   5. Route Table Deployment 1 (connectivity)
#   6. NSG Deployment 1 (management)
#   7. NSG Deployment 1 (identity)
#   8. NSG Deployment 1 (connectivity)
#   9. Tools Deployment 1 (dmz)
#   10. Network Deployment 1 (dmz)
#   11. Network Deployment 2 (management)
#   12. Network Deployment 2 (identity)
#   13. Network Deployment 2 (connectivity)
#   14. Tools Deployment 1 (connectivity)
#   15. Tools Deployment 1 (identity)
#   16. Tools Deployment 2 (management)
#   17. Tools Deployment 1 (management)
#   18. Network Deployment 1 (management)
#   19. Network Deployment 1 (identity)
#   20. Network Deployment 1 (connectivity)
#
# This workflow includes a confirmation gate — you must type "DESTROY" to proceed.

name: Full Landing Zone Destroy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to destroy'
        required: true
        type: choice
        options:
          - production
          - staging
          - development
        default: 'production'
      confirm_destroy:
        description: 'Type DESTROY to confirm'
        required: true
        type: string

permissions:
  id-token: write
  contents: read

env:
  TF_VERSION: '1.5.0'

jobs:
  validate-destroy:
    name: '⚠️ Validate Destroy Confirmation'
    runs-on: ubuntu-latest
    steps:
      - name: Check confirmation
        run: |
          if [ "${{ github.event.inputs.confirm_destroy }}" != "DESTROY" ]; then
            echo "::error::You must type DESTROY in the confirm_destroy input to proceed."
            echo "::error::This is a safety check to prevent accidental destruction."
            exit 1
          fi
          echo "Destroy confirmation validated. Proceeding with full destroy..."
  destroy_1_dmz_route_table_deployment_1_plan:
    name: 'Destroy 1/20 Plan: Route Table Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: validate-destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-1-route-table-deployment-1
          path: landingzone/hub-spoke-primary/dmz/route-table-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_1_dmz_route_table_deployment_1_destroy:
    name: 'Destroy 1/20 Apply: Route Table Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_1_dmz_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-1-route-table-deployment-1
          path: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_2_dmz_nsg_deployment_1_plan:
    name: 'Destroy 2/20 Plan: NSG Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_1_dmz_route_table_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-2-nsg-deployment-1
          path: landingzone/hub-spoke-primary/dmz/nsg-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_2_dmz_nsg_deployment_1_destroy:
    name: 'Destroy 2/20 Apply: NSG Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_2_dmz_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-2-nsg-deployment-1
          path: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_3_management_route_table_deployment_1_plan:
    name: 'Destroy 3/20 Plan: Route Table Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_2_dmz_nsg_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-3-route-table-deployment-1
          path: landingzone/hub-spoke-primary/management/route-table-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_3_management_route_table_deployment_1_destroy:
    name: 'Destroy 3/20 Apply: Route Table Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_3_management_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-3-route-table-deployment-1
          path: landingzone/hub-spoke-primary/management/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_4_identity_route_table_deployment_1_plan:
    name: 'Destroy 4/20 Plan: Route Table Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_3_management_route_table_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-4-route-table-deployment-1
          path: landingzone/hub-spoke-primary/identity/route-table-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_4_identity_route_table_deployment_1_destroy:
    name: 'Destroy 4/20 Apply: Route Table Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_4_identity_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-4-route-table-deployment-1
          path: landingzone/hub-spoke-primary/identity/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/identity/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_5_connectivity_route_table_deployment_1_plan:
    name: 'Destroy 5/20 Plan: Route Table Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_4_identity_route_table_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-5-route-table-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_5_connectivity_route_table_deployment_1_destroy:
    name: 'Destroy 5/20 Apply: Route Table Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_5_connectivity_route_table_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-5-route-table-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/route-table-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_6_management_nsg_deployment_1_plan:
    name: 'Destroy 6/20 Plan: NSG Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_5_connectivity_route_table_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-6-nsg-deployment-1
          path: landingzone/hub-spoke-primary/management/nsg-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_6_management_nsg_deployment_1_destroy:
    name: 'Destroy 6/20 Apply: NSG Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_6_management_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-6-nsg-deployment-1
          path: landingzone/hub-spoke-primary/management/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_7_identity_nsg_deployment_1_plan:
    name: 'Destroy 7/20 Plan: NSG Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_6_management_nsg_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-7-nsg-deployment-1
          path: landingzone/hub-spoke-primary/identity/nsg-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_7_identity_nsg_deployment_1_destroy:
    name: 'Destroy 7/20 Apply: NSG Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_7_identity_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-7-nsg-deployment-1
          path: landingzone/hub-spoke-primary/identity/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/identity/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_8_connectivity_nsg_deployment_1_plan:
    name: 'Destroy 8/20 Plan: NSG Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_7_identity_nsg_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-8-nsg-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_8_connectivity_nsg_deployment_1_destroy:
    name: 'Destroy 8/20 Apply: NSG Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_8_connectivity_nsg_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-8-nsg-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/nsg-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_9_dmz_tools_deployment_1_plan:
    name: 'Destroy 9/20 Plan: Tools Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_8_connectivity_nsg_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-9-tools-deployment-1
          path: landingzone/hub-spoke-primary/dmz/tools-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_9_dmz_tools_deployment_1_destroy:
    name: 'Destroy 9/20 Apply: Tools Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_9_dmz_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-9-tools-deployment-1
          path: landingzone/hub-spoke-primary/dmz/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_10_dmz_network_deployment_1_plan:
    name: 'Destroy 10/20 Plan: Network Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_9_dmz_tools_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-10-network-deployment-1
          path: landingzone/hub-spoke-primary/dmz/network-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_10_dmz_network_deployment_1_destroy:
    name: 'Destroy 10/20 Apply: Network Deployment 1 (dmz)'
    runs-on: ubuntu-latest
    needs: destroy_10_dmz_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-10-network-deployment-1
          path: landingzone/hub-spoke-primary/dmz/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/dmz/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_11_management_network_deployment_2_plan:
    name: 'Destroy 11/20 Plan: Network Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: destroy_10_dmz_network_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-11-network-deployment-2
          path: landingzone/hub-spoke-primary/management/network-deployment-2/tfplan-destroy
          retention-days: 1

  destroy_11_management_network_deployment_2_destroy:
    name: 'Destroy 11/20 Apply: Network Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: destroy_11_management_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-11-network-deployment-2
          path: landingzone/hub-spoke-primary/management/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_12_identity_network_deployment_2_plan:
    name: 'Destroy 12/20 Plan: Network Deployment 2 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_11_management_network_deployment_2_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-12-network-deployment-2
          path: landingzone/hub-spoke-primary/identity/network-deployment-2/tfplan-destroy
          retention-days: 1

  destroy_12_identity_network_deployment_2_destroy:
    name: 'Destroy 12/20 Apply: Network Deployment 2 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_12_identity_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-12-network-deployment-2
          path: landingzone/hub-spoke-primary/identity/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_13_connectivity_network_deployment_2_plan:
    name: 'Destroy 13/20 Plan: Network Deployment 2 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_12_identity_network_deployment_2_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-13-network-deployment-2
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-2/tfplan-destroy
          retention-days: 1

  destroy_13_connectivity_network_deployment_2_destroy:
    name: 'Destroy 13/20 Apply: Network Deployment 2 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_13_connectivity_network_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-13-network-deployment-2
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-2
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_14_connectivity_tools_deployment_1_plan:
    name: 'Destroy 14/20 Plan: Tools Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_13_connectivity_network_deployment_2_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-14-tools-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/tools-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_14_connectivity_tools_deployment_1_destroy:
    name: 'Destroy 14/20 Apply: Tools Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_14_connectivity_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-14-tools-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_15_identity_tools_deployment_1_plan:
    name: 'Destroy 15/20 Plan: Tools Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_14_connectivity_tools_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-15-tools-deployment-1
          path: landingzone/hub-spoke-primary/identity/tools-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_15_identity_tools_deployment_1_destroy:
    name: 'Destroy 15/20 Apply: Tools Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_15_identity_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-15-tools-deployment-1
          path: landingzone/hub-spoke-primary/identity/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/identity/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_16_management_tools_deployment_2_plan:
    name: 'Destroy 16/20 Plan: Tools Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: destroy_15_identity_tools_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-16-tools-deployment-2
          path: landingzone/hub-spoke-primary/management/tools-deployment-2/tfplan-destroy
          retention-days: 1

  destroy_16_management_tools_deployment_2_destroy:
    name: 'Destroy 16/20 Apply: Tools Deployment 2 (management)'
    runs-on: ubuntu-latest
    needs: destroy_16_management_tools_deployment_2_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-16-tools-deployment-2
          path: landingzone/hub-spoke-primary/management/tools-deployment-2
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-2
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_17_management_tools_deployment_1_plan:
    name: 'Destroy 17/20 Plan: Tools Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_16_management_tools_deployment_2_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-17-tools-deployment-1
          path: landingzone/hub-spoke-primary/management/tools-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_17_management_tools_deployment_1_destroy:
    name: 'Destroy 17/20 Apply: Tools Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_17_management_tools_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-17-tools-deployment-1
          path: landingzone/hub-spoke-primary/management/tools-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/tools-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_18_management_network_deployment_1_plan:
    name: 'Destroy 18/20 Plan: Network Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_17_management_tools_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-18-network-deployment-1
          path: landingzone/hub-spoke-primary/management/network-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_18_management_network_deployment_1_destroy:
    name: 'Destroy 18/20 Apply: Network Deployment 1 (management)'
    runs-on: ubuntu-latest
    needs: destroy_18_management_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-18-network-deployment-1
          path: landingzone/hub-spoke-primary/management/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/management/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_19_identity_network_deployment_1_plan:
    name: 'Destroy 19/20 Plan: Network Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_18_management_network_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-19-network-deployment-1
          path: landingzone/hub-spoke-primary/identity/network-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_19_identity_network_deployment_1_destroy:
    name: 'Destroy 19/20 Apply: Network Deployment 1 (identity)'
    runs-on: ubuntu-latest
    needs: destroy_19_identity_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-19-network-deployment-1
          path: landingzone/hub-spoke-primary/identity/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/identity/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
  destroy_20_connectivity_network_deployment_1_plan:
    name: 'Destroy 20/20 Plan: Network Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_19_identity_network_deployment_1_destroy
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Plan Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform plan -destroy -input=false -out=tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Upload Destroy Plan Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tfplan-destroy-step-20-network-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-1/tfplan-destroy
          retention-days: 1

  destroy_20_connectivity_network_deployment_1_destroy:
    name: 'Destroy 20/20 Apply: Network Deployment 1 (connectivity)'
    runs-on: ubuntu-latest
    needs: destroy_20_connectivity_network_deployment_1_plan
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Azure Login (OIDC)
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TF_VERSION }}
      
      - name: Download Destroy Plan Artifact
        uses: actions/download-artifact@v4
        with:
          name: tfplan-destroy-step-20-network-deployment-1
          path: landingzone/hub-spoke-primary/connectivity/network-deployment-1
      
      - name: Terraform Init
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform init -input=false
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      
      - name: Terraform Destroy
        working-directory: landingzone/hub-spoke-primary/connectivity/network-deployment-1
        run: terraform apply -input=false -auto-approve tfplan-destroy
        env:
          ARM_USE_OIDC: true
          ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
